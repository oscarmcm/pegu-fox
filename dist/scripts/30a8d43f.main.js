function Tile(a){this.ratio=window.devicePixelRatio||1,this.n=a.n,this.isball=a.isball,this.istile=a.istile}function Grid(a,b){this.size=b.size,this.level=b,this.storage=a,this.cells=this.build()}function Display(){this.events={},this.availableMoves={up:!1,right:!1,down:!1,left:!1},this.balls=[],this.score=0,this.isTouch=createjs.Touch.isSupported(),this.init()}function LocalStorage(){this.levelID="pegu_level";var a=this.localStorageSupported();this.storage=a?window.localStorage:window.bkStorage}function Social(){}function Sound(){this.createMoveSound()}function Game(){this.storage=new LocalStorage,this.social=new Social,this.sound=new Sound,this.ison=!1,this.shortcurmove=!1,this.init()}var addToHome=function(a){function b(){if(y){var b,d=Date.now();if(a.addToHomeConfig)for(b in a.addToHomeConfig)C[b]=a.addToHomeConfig[b];C.autostart||(C.hookOnLoad=!1),l=/ipad/gi.test(x.platform),m=a.devicePixelRatio&&a.devicePixelRatio>1,n=/Safari/i.test(x.appVersion)&&!/CriOS/i.test(x.appVersion),o=x.standalone,p=x.appVersion.match(/OS (\d+_\d+)/i),p=p&&p[1]?+p[1].replace("_","."):0,B=+a.localStorage.getItem("addToHome"),r=a.sessionStorage.getItem("addToHomeSession"),s=C.returningVisitor?B&&B+24192e5>d:!0,B||(B=d),q=s&&d>=B,C.hookOnLoad?a.addEventListener("load",c,!1):!C.hookOnLoad&&C.autostart&&c()}}function c(){if(a.removeEventListener("load",c,!1),s?C.expire&&q&&a.localStorage.setItem("addToHome",Date.now()+6e4*C.expire):a.localStorage.setItem("addToHome",Date.now()),u||n&&q&&!r&&!o&&s){var b="",e=x.platform.split(" ")[0],f=x.language.replace("-","_");t=document.createElement("div"),t.id="addToHomeScreen",t.style.cssText+="left:-9999px;-webkit-transition-property:-webkit-transform,opacity;-webkit-transition-duration:0;-webkit-transform:translate3d(0,0,0);position:"+(5>p?"absolute":"fixed"),C.message in D&&(f=C.message,C.message=""),""===C.message&&(C.message=f in D?D[f]:D.en_us),C.touchIcon&&(b=document.querySelector(m?'head link[rel^=apple-touch-icon][sizes="114x114"],head link[rel^=apple-touch-icon][sizes="144x144"],head link[rel^=apple-touch-icon]':'head link[rel^=apple-touch-icon][sizes="57x57"],head link[rel^=apple-touch-icon]'),b&&(b='<span style="background-image:url('+b.href+')" class="addToHomeTouchIcon"></span>')),t.className=(p>=7?"addToHomeIOS7 ":"")+(l?"addToHomeIpad":"addToHomeIphone")+(b?" addToHomeWide":""),t.innerHTML=b+C.message.replace("%device",e).replace("%icon",p>=4.2?'<span class="addToHomeShare"></span>':'<span class="addToHomePlus">+</span>')+(C.arrow?'<span class="addToHomeArrow"'+(p>=7&&l&&b?' style="margin-left:-32px"':"")+"></span>":"")+(C.closeButton?'<span class="addToHomeClose">×</span>':""),document.body.appendChild(t),C.closeButton&&t.addEventListener("click",g,!1),!l&&p>=6&&window.addEventListener("orientationchange",k,!1),setTimeout(d,C.startDelay)}}function d(){var b,c=208;if(l)switch(5>p?(A=a.scrollY,z=a.scrollX):6>p?c=160:p>=7&&(c=143),t.style.top=A+C.bottomOffset+"px",t.style.left=Math.max(z+c-Math.round(t.offsetWidth/2),9)+"px",C.animationIn){case"drop":b="0.6s",t.style.webkitTransform="translate3d(0,"+-(a.scrollY+C.bottomOffset+t.offsetHeight)+"px,0)";break;case"bubble":b="0.6s",t.style.opacity="0",t.style.webkitTransform="translate3d(0,"+(A+50)+"px,0)";break;default:b="1s",t.style.opacity="0"}else switch(A=a.innerHeight+a.scrollY,5>p?(z=Math.round((a.innerWidth-t.offsetWidth)/2)+a.scrollX,t.style.left=z+"px",t.style.top=A-t.offsetHeight-C.bottomOffset+"px"):(t.style.left="50%",t.style.marginLeft=-Math.round(t.offsetWidth/2)-(a.orientation%180&&p>=6&&7>p?40:0)+"px",t.style.bottom=C.bottomOffset+"px"),C.animationIn){case"drop":b="1s",t.style.webkitTransform="translate3d(0,"+-(A+C.bottomOffset)+"px,0)";break;case"bubble":b="0.6s",t.style.webkitTransform="translate3d(0,"+(t.offsetHeight+C.bottomOffset+50)+"px,0)";break;default:b="1s",t.style.opacity="0"}t.offsetHeight,t.style.webkitTransitionDuration=b,t.style.opacity="1",t.style.webkitTransform="translate3d(0,0,0)",t.addEventListener("webkitTransitionEnd",h,!1),w=setTimeout(f,C.lifespan)}function e(a){y&&!t&&(u=a,c())}function f(){if(clearInterval(v),clearTimeout(w),w=null,t){var b=0,c=0,d="1",e="0";switch(C.closeButton&&t.removeEventListener("click",g,!1),!l&&p>=6&&window.removeEventListener("orientationchange",k,!1),5>p&&(b=l?a.scrollY-A:a.scrollY+a.innerHeight-A,c=l?a.scrollX-z:a.scrollX+Math.round((a.innerWidth-t.offsetWidth)/2)-z),t.style.webkitTransitionProperty="-webkit-transform,opacity",C.animationOut){case"drop":l?(e="0.4s",d="0",b+=50):(e="0.6s",b+=t.offsetHeight+C.bottomOffset+50);break;case"bubble":l?(e="0.8s",b-=t.offsetHeight+C.bottomOffset+50):(e="0.4s",d="0",b-=50);break;default:e="0.8s",d="0"}t.addEventListener("webkitTransitionEnd",h,!1),t.style.opacity=d,t.style.webkitTransitionDuration=e,t.style.webkitTransform="translate3d("+c+"px,"+b+"px,0)"}}function g(){a.sessionStorage.setItem("addToHomeSession","1"),r=!0,f()}function h(){return t.removeEventListener("webkitTransitionEnd",h,!1),t.style.webkitTransitionProperty="-webkit-transform",t.style.webkitTransitionDuration="0.2s",w?void(5>p&&w&&(v=setInterval(i,C.iterations))):(t.parentNode.removeChild(t),void(t=null))}function i(){var b=new WebKitCSSMatrix(a.getComputedStyle(t,null).webkitTransform),c=l?a.scrollY-A:a.scrollY+a.innerHeight-A,d=l?a.scrollX-z:a.scrollX+Math.round((a.innerWidth-t.offsetWidth)/2)-z;(c!=b.m42||d!=b.m41)&&(t.style.webkitTransform="translate3d("+d+"px,"+c+"px,0)")}function j(){a.localStorage.removeItem("addToHome"),a.sessionStorage.removeItem("addToHomeSession")}function k(){t.style.marginLeft=-Math.round(t.offsetWidth/2)-(a.orientation%180&&p>=6&&7>p?40:0)+"px"}var l,m,n,o,p,q,r,s,t,u,v,w,x=a.navigator,y="platform"in x&&/iphone|ipod|ipad/gi.test(x.platform),z=0,A=0,B=0,C={autostart:!0,returningVisitor:!1,animationIn:"drop",animationOut:"fade",startDelay:2e3,lifespan:15e3,bottomOffset:14,expire:0,message:"",touchIcon:!1,arrow:!0,hookOnLoad:!0,closeButton:!0,iterations:100},D={ar:'<span dir="rtl">قم بتثبيت هذا التطبيق على <span dir="ltr">%device:</span>انقر<span dir="ltr">%icon</span> ،<strong>ثم اضفه الى الشاشة الرئيسية.</strong></span>',ca_es:"Per instal·lar aquesta aplicació al vostre %device premeu %icon i llavors <strong>Afegir a pantalla d'inici</strong>.",cs_cz:"Pro instalaci aplikace na Váš %device, stiskněte %icon a v nabídce <strong>Přidat na plochu</strong>.",da_dk:"Tilføj denne side til din %device: tryk på %icon og derefter <strong>Føj til hjemmeskærm</strong>.",de_de:"Installieren Sie diese App auf Ihrem %device: %icon antippen und dann <strong>Zum Home-Bildschirm</strong>.",el_gr:"Εγκαταστήσετε αυτήν την Εφαρμογή στήν συσκευή σας %device: %icon μετά πατάτε <strong>Προσθήκη σε Αφετηρία</strong>.",en_us:"Install this web app on your %device: tap %icon and then <strong>Add to Home Screen</strong>.",es_es:"Para instalar esta app en su %device, pulse %icon y seleccione <strong>Añadir a pantalla de inicio</strong>.",fi_fi:"Asenna tämä web-sovellus laitteeseesi %device: paina %icon ja sen jälkeen valitse <strong>Lisää Koti-valikkoon</strong>.",fr_fr:"Ajoutez cette application sur votre %device en cliquant sur %icon, puis <strong>Sur l'écran d'accueil</strong>.",he_il:'<span dir="rtl">התקן אפליקציה זו על ה-%device שלך: הקש %icon ואז <strong>הוסף למסך הבית</strong>.</span>',hr_hr:"Instaliraj ovu aplikaciju na svoj %device: klikni na %icon i odaberi <strong>Dodaj u početni zaslon</strong>.",hu_hu:"Telepítse ezt a web-alkalmazást az Ön %device-jára: nyomjon a %icon-ra majd a <strong>Főképernyőhöz adás</strong> gombra.",it_it:"Installa questa applicazione sul tuo %device: premi su %icon e poi <strong>Aggiungi a Home</strong>.",ja_jp:"このウェブアプリをあなたの%deviceにインストールするには%iconをタップして<strong>ホーム画面に追加</strong>を選んでください。",ko_kr:'%device에 웹앱을 설치하려면 %icon을 터치 후 "홈화면에 추가"를 선택하세요',nb_no:"Installer denne appen på din %device: trykk på %icon og deretter <strong>Legg til på Hjem-skjerm</strong>",nl_nl:"Installeer deze webapp op uw %device: tik %icon en dan <strong>Voeg toe aan beginscherm</strong>.",pl_pl:"Aby zainstalować tę aplikacje na %device: naciśnij %icon a następnie <strong>Dodaj jako ikonę</strong>.",pt_br:"Instale este aplicativo em seu %device: aperte %icon e selecione <strong>Adicionar à Tela Inicio</strong>.",pt_pt:"Para instalar esta aplicação no seu %device, prima o %icon e depois em <strong>Adicionar ao ecrã principal</strong>.",ru_ru:"Установите это веб-приложение на ваш %device: нажмите %icon, затем <strong>Добавить в «Домой»</strong>.",sv_se:"Lägg till denna webbapplikation på din %device: tryck på %icon och därefter <strong>Lägg till på hemskärmen</strong>.",th_th:"ติดตั้งเว็บแอพฯ นี้บน %device ของคุณ: แตะ %icon และ <strong>เพิ่มที่หน้าจอโฮม</strong>",tr_tr:"Bu uygulamayı %device'a eklemek için %icon simgesine sonrasında <strong>Ana Ekrana Ekle</strong> düğmesine basın.",uk_ua:"Встановіть цей веб сайт на Ваш %device: натисніть %icon, а потім <strong>На початковий екран</strong>.",zh_cn:"您可以将此应用安装到您的 %device 上。请按 %icon 然后选择<strong>添加至主屏幕</strong>。",zh_tw:"您可以將此應用程式安裝到您的 %device 上。請按 %icon 然後點選<strong>加入主畫面螢幕</strong>。"};return b(),{show:e,close:f,reset:j}}(window);Tile.prototype.getState=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},Tile.prototype.updateState=function(a){this.x=a.x*this.ratio,this.y=a.y*this.ratio,this.width=a.width*this.ratio,this.height=a.height*this.ratio},Tile.prototype.addBall=function(){this.isball=!0},Tile.prototype.removeBall=function(){this.isball=!1},Tile.prototype.serialize=function(){return{n:this.n,isball:this.isball,istile:this.istile}},Grid.prototype.build=function(){var a=[],b=1,c=this.storage?this.storage.grid:this.level;this.balls=c.currentScheme.length-c.emptySpots.length;for(var d=0;d<this.size;d++)for(var e=a[d]=[],f=0;f<this.size;f++){var g={};g.isball=$.inArray(b,c.currentScheme)>=0&&$.inArray(b,c.emptySpots)<0?!0:!1,g.istile=$.inArray(b,c.currentScheme)>=0?!0:!1,g.n=b;var h=new Tile(g);e.push(h),b++}return a},Grid.prototype.serialize=function(){var a=[],b=[];return this.eachCell(function(c,d,e){e.istile&&a.push(e.n),!e.isball&&e.istile&&b.push(e.n)}),{currentScheme:a,emptySpots:b}},Grid.prototype.getBalls=function(){var a=[];return this.eachCell(function(b,c,d){d.isball&&a.push(d)}),a},Grid.prototype.movesArray=function(a){var b={up:!1,right:!1,down:!1,left:!1},c=this,d=c.getTile(a);return this.eachCell(function(e,f){var g=c.cells[e][f];0==g.isball&&1==g.istile&&(g.n==a-2*c.size&&1==c.getTile(a-c.size).isball&&d.y==g.y?b.left=a-2*c.size:g.n==a+2*c.size&&1==c.getTile(a+c.size).isball&&d.y==g.y?b.right=a+2*c.size:g.n==a-2&&1==c.getTile(a-1).isball&&d.x==g.x?b.up=a-2:g.n==a+2&&1==c.getTile(a+1).isball&&d.x==g.x&&(b.down=a+2))}),b},Grid.prototype.eachCell=function(a){for(var b=0;b<this.size;b++)for(var c=0;c<this.size;c++)a(b,c,this.cells[b][c])},Grid.prototype.getTile=function(a){var b;return this.eachCell(function(c,d,e){e.n==a&&(b=e)}),b},Grid.prototype.moveTile=function(a,b){var c,d={};d.from_n=this.getTile(a),d.to_n=this.getTile(b),d.to_n.addBall(),d.from_n.removeBall(),b-2*this.size==a&&(c=b-this.size,d.eaten=this.getTile(c),d.eaten.removeBall()),b+2*this.size==a&&(c=b+this.size,d.eaten=this.getTile(c),d.eaten.removeBall()),b+2==a&&(c=b+1,d.eaten=this.getTile(c),d.eaten.removeBall()),b-2==a&&(c=b-1,d.eaten=this.getTile(c),d.eaten.removeBall());var e={to_n:d.to_n.n,from_n:d.from_n.n,eaten:d.eaten.n,final_position:{x:d.to_n.x,y:d.to_n.y}};return e},Display.prototype.init=function(){var a=this,b=document.getElementById("canvasHolder"),c=document.createElement("canvas"),d=Hammer(c);d.on("dragleft dragright dragup dragdown swipeleft swiperight swipeup swipedown",function(b){b.gesture.preventDefault(),("dragleft"==b.type||"swipeleft"==b.type)&&(a.chose="left"),("dragright"==b.type||"swiperight"==b.type)&&(a.chose="right"),("dragdown"==b.type||"swipedown"==b.type)&&(a.chose="down"),("dragup"==b.type||"swipeup"==b.type)&&(a.chose="up"),a.emit("mousedown",{n:a.selected,chose:a.chose}),b.gesture.stopDetect()}),c.id="pegu",c.width=window.innerHeight,c.height=window.innerHeight,b.appendChild(c),this.canvas=c,this.stage=new createjs.Stage(this.canvas),this.stage.enableMouseOver(20),this.stage.mouseMoveOutside=!0,this.container=new createjs.Container,this.stage.addChild(this.container),this.scoreBoard=document.getElementById("scoreboard"),this.textBoard=document.getElementById("panel"),this.infoBoard=document.getElementById("info"),createjs.Touch.enable(this.stage),createjs.Ticker.addEventListener("tick",function(b){a.tick(b)}),this.pauseTicker(),window.alphaThresh=.75,$(window).resize(function(){clearTimeout(this.resizeTO),this.resizeTO=setTimeout(function(){a.draw()},100)})},Display.prototype.tick=function(a){(!a.paused||this.update)&&(this.stage.update(a),this.update=!1)},Display.prototype.pauseTicker=function(a){setTimeout(function(){createjs.Ticker.setPaused(!0)},a||100)},Display.prototype.playTicker=function(){createjs.Ticker.setPaused(!1)},Display.prototype.getPercent=function(a,b){return a-a*b/100},Display.prototype.on=function(a,b){this.events[a]||(this.events[a]=[]),this.events[a].push(b)},Display.prototype.emit=function(a,b){var c=this.events[a];c&&c.forEach(function(a){a(b)})},Display.prototype.updateStage=function(){this.update=!0},Display.prototype.eachChildren=function(a,b){for(var c=0;c<a.children.length;c++)b(a.children[c])},Display.prototype.draw=function(){this.playTicker(),this.emit("draw_board"),this.displayText(" "),this.drawn_balls=0,this.container.removeAllChildren(),this.container.removeAllEventListeners(),this.board=new createjs.Container,this.tiles=new createjs.Container,this.pegs=new createjs.Container,this.ratio=window.devicePixelRatio||1;var a=window.innerWidth,b=window.innerHeight,c=Math.min(a,b),d=Math.floor(c/(this.size+1||8));this.container.addChild(this.board),this.board.addChild(this.tiles),this.board.addChild(this.pegs),this.canvas.width=a*this.ratio,this.canvas.height=b*this.ratio,this.canvas.setAttribute("width",Math.round(a*this.ratio)),this.canvas.setAttribute("height",Math.round(b*this.ratio)),this.canvas.style.width=a+"px",this.canvas.style.height=b+"px",this.board.x=Math.floor(a*this.ratio/2-this.size*this.ratio*d/2),this.board.y=Math.floor(b*this.ratio/2-this.size*this.ratio*d/2),this.stage.scaleX=this.stage.scaleY=1;for(var e=0;e<this.grid.cells.length;e++)for(var f=this.grid.cells[e],g=0;g<f.length;g++){var h=f[g],i={};i.x=e*d,i.y=g*d,i.width=d,i.height=d,h.updateState(i),this.addNewTile(h),this.addNewBall(h)}},Display.prototype.render=function(a,b){createjs.Tween.removeAllTweens(),this.gameStatus=b,this.size=a.size,this.grid=a,this.draw()},Display.prototype.moveTile=function(a){this.playTicker(),this.ismoving=!0;var b=this,c=this.balls[a.from_n];this.balls[a.to_n]=c,c.n=a.to_n,this.rollout(c),createjs.Tween.get(c).to({x:a.final_position.x,y:a.final_position.y},150,createjs.Ease.linear).call(function(){b.pauseTicker(200),b.ismoving=!1,b.pegs.removeChild(b.balls[a.eaten])})},Display.prototype.setAvailableMoves=function(a){this.availableMoves=a},Display.prototype.getHoverHelper=function(a,b){var c=new createjs.Shape,d={width:this.getPercent(a.width,10),height:this.getPercent(a.height,10)};return c.alpha=0,c.regX=d.width/2,c.regY=d.height/2,c.x=a.width/2,c.y=a.height/2,c.name="arrow_"+b,c.graphics.beginFill("rgba(240,117,110,0.6)"),"up"==b?c.graphics.drawRoundRectComplex(0,0,d.width,d.height/4,5,5,0,0):"down"==b?c.graphics.drawRoundRectComplex(0,d.height-d.height/4,d.width,d.height/4,0,0,5,5):"left"==b?c.graphics.drawRoundRectComplex(0,0,d.width/4,d.height,5,0,0,5):"right"==b&&c.graphics.drawRoundRectComplex(d.width-d.width/4,0,d.width/4,d.height,0,5,5,0),c},Display.prototype.displayLevelName=function(a){var b=document.createElement("span");b.setAttribute("id","level_name"),b.appendChild(document.createTextNode(a));var c=document.getElementById("level_name");this.infoBoard.replaceChild(b,c)},Display.prototype.displayText=function(a){var b=document.createElement("span");b.setAttribute("id","textnode"),b.appendChild(document.createTextNode(a));var c=document.getElementById("textnode");this.textBoard.replaceChild(b,c)},Display.prototype.setScore=function(a){var b=document.createElement("span");b.setAttribute("id","score"),b.appendChild(document.createTextNode(a));var c=document.getElementById("score");this.scoreBoard.replaceChild(b,c)},Display.prototype.helperRollout=function(a){this.chose=!1,this.onechoice||(a.currentTarget.alpha=.5),this.updateStage()},Display.prototype.addNewBall=function(a){var b=this;if(a.isball&&a.istile){var c=new createjs.Container,d={width:this.getPercent(a.width,10),height:this.getPercent(a.height,10)},e=(new createjs.Graphics).beginFill("rgba(255,255,255,1)").drawRoundRect(0,0,d.width,d.height,5),f=new createjs.Shape(e);f.scale=1,f.regX=d.width/2,f.regY=d.height/2,f.x=a.width/2,f.y=a.height/2,f.scaleX=0,f.scaleY=0,c.addChild(f),c.name="ball_"+a.n,c.x=a.x,c.y=a.y,c.n=a.n;var g=new createjs.Container;g.name="helper",c.addChild(g);var h=this.getHoverHelper(a,"down");g.addChild(h),h.addEventListener("rollover",function(a){var c=a.currentTarget.parent.parent;b.rollover(c),b.chose="down",a.currentTarget.alpha=1,b.updateStage()}),h.addEventListener("rollout",function(a){b.helperRollout(a)});var i=this.getHoverHelper(a,"up");g.addChild(i),i.addEventListener("rollover",function(a){var c=a.currentTarget.parent.parent;b.rollover(c),b.chose="up",a.currentTarget.alpha=1,b.updateStage()}),i.addEventListener("rollout",function(a){b.helperRollout(a)});var j=this.getHoverHelper(a,"right");g.addChild(j),j.addEventListener("rollover",function(a){var c=a.currentTarget.parent.parent;b.rollover(c),b.chose="right",a.currentTarget.alpha=1,b.updateStage()}),j.addEventListener("rollout",function(a){b.helperRollout(a)});var k=this.getHoverHelper(a,"left");g.addChild(k),k.addEventListener("rollover",function(a){var c=a.currentTarget.parent.parent;b.rollover(c),b.chose="left",a.currentTarget.alpha=1,b.updateStage()}),k.addEventListener("rollout",function(a){b.helperRollout(a)}),f.cache(f.x-a.height-10,f.y-a.height+10,2*a.width+10,2*a.height+10),this.gameStatus&&(c.cursor="pointer"),this.balls[a.n]=c,this.pegs.addChild(c),c.addEventListener("mousedown",function(a){b.mousedown(a.currentTarget)}),c.addEventListener("rollover",function(a){b.rollover(a.currentTarget)}),c.addEventListener("rollout",function(a){b.rollout(a.currentTarget)}),createjs.Tween.get(f).wait(10*a.n).to({scaleX:1,scaleY:1},300,createjs.Ease.bounceOut).call(function(){b.drawn_balls++,b.grid.balls==b.drawn_balls&&b.pauseTicker()})}},Display.prototype.addNewTile=function(a){var b=new createjs.Container;if(b.name="square_"+a.n,a.istile){var c=(new createjs.Graphics).beginFill("rgba(240,117,110,1)").drawRoundRect(0,0,a.width,a.height,2),d=new createjs.Shape(c);b.x=a.x,b.y=a.y,d.cache(d.x-a.height-10,d.y-a.height+10,2*a.width+10,2*a.height+10),b.addChild(d),this.tiles.addChild(b)}},Display.prototype.mousedown=function(a){this.gameStatus&&(this.selected=a.n,this.isTouch||this.emit("mousedown",{n:a.n,chose:this.chose}))},Display.prototype.rollover=function(a){if(1==this.gameStatus&&!this.ismoving){a.parent.addChild(a),this.chose=!1,this.onechoice=!1,this.emit("rollover",{n:a.n});var b=a.getChildByName("helper"),c=[];this.availableMoves.down&&(b.getChildByName("arrow_down").alpha=.5,c.push("arrow_down")),this.availableMoves.up&&(b.getChildByName("arrow_up").alpha=.5,c.push("arrow_up")),this.availableMoves.right&&(b.getChildByName("arrow_right").alpha=.5,c.push("arrow_right")),this.availableMoves.left&&(b.getChildByName("arrow_left").alpha=.5,c.push("arrow_left")),1==c.length&&(this.onechoice=!0,b.getChildByName(c[0]).alpha=1),this.updateStage()}},Display.prototype.rollout=function(a){for(var b=a.getChildByName("helper"),c=0;c<b.children.length;c++)b.children[c].alpha=0;this.updateStage()},window.bkStorage={_data:{},setItem:function(a,b){return this._data[a]=String(b)},getItem:function(a){return this._data.hasOwnProperty(a)?this._data[a]:void 0},removeItem:function(a){return delete this._data[a]},clear:function(){return this._data={}}},LocalStorage.prototype.localStorageSupported=function(){var a="test",b=window.localStorage;try{return b.setItem(a,"1"),b.removeItem(a),!0}catch(c){return!1}},LocalStorage.prototype.setLevelID=function(a){this.storage.setItem(this.levelID,a)},LocalStorage.prototype.getLevelID=function(){return this.storage.getItem(this.levelID)},LocalStorage.prototype.clearCurrentLevel=function(){this.storage.removeItem("pegu_level_"+this.getLevelID())},LocalStorage.prototype.getCurrenLevel=function(){var a=this.storage.getItem("pegu_level_"+this.getLevelID());return a?JSON.parse(a):null},LocalStorage.prototype.getLevel=function(a){var b=this.storage.getItem("pegu_level_"+a);return b?JSON.parse(b):null},LocalStorage.prototype.setLevel=function(a){var b="pegu_level_"+a.level;this.storage.setItem(b,JSON.stringify(a))},LocalStorage.prototype.setGameStatus=function(a){this.storage.setItem("pegu_status",a)},LocalStorage.prototype.getGameStatus=function(){return this.storage.getItem("pegu_status")||0},Social.prototype.destroyLayer=function(){window.publicMethods.destroy(),this.open=!1},Social.prototype.callback=function(){this.smart="3"},Social.prototype.addLayer=function(){this.open=!0,this.layer=addthis.layers({theme:"transparent",share:{position:"left",services:"facebook,twitter,google_plusone_share"}})},Social.prototype.isopen=function(){return this.open},Sound.prototype.victory=function(){this.moveSound=createjs.Sound.play("victory"),this.moveSound.volume=.2},Sound.prototype.dispose=function(){this.moveSound=createjs.Sound.play("tick"),this.moveSound.volume=.2},Sound.prototype.loss=function(){this.sound=createjs.Sound.play("loss"),this.sound.volume=.2},Sound.prototype.move=function(){this.moveSound=createjs.Sound.play("move"),this.moveSound.volume=.2},Sound.prototype.createMoveSound=function(){createjs.Sound.initializeDefaultPlugins()&&(createjs.Sound.alternateExtensions=["mp3"],createjs.Sound.registerSound("sounds/move.ogg","move"),createjs.Sound.registerSound("sounds/victory.ogg","victory"),createjs.Sound.registerSound("sounds/loss.ogg","loss"),createjs.Sound.registerSound("sounds/tick.ogg","tick"))},Game.prototype.init=function(){var a=this;this.levels=this.readLevels(),this.display=new Display,this.display.on("draw_board",this.draw_board.bind(this)),this.display.on("automoved",this.autoMove.bind(this)),this.display.on("rollover",this.setMoves.bind(this)),this.display.on("mousedown",this.mousedown.bind(this)),this.display.on("pressup",this.pressup.bind(this)),setTimeout(function(){a.start()},100)},Game.prototype.setMoves=function(a){var b=this.grid.movesArray(a.n),c=[];for(var d in b){var e=b[d];if(e){var f={dir:d,n:e};c.push(f)}}return this.display.setAvailableMoves(b),c},Game.prototype.mousedown=function(a){var b=this,c=this.setMoves(a),d=!1;if(a.chose)for(var e=0;e<c.length;e++)c[e].dir==a.chose&&(d=c[e]);else 1==c.length&&(d=c[0]);if(d){var f=this.grid.moveTile(a.n,d.n);if(f)if(this.display.moveTile(f),this.sound.move(),this.addPoints(),this.saveState(),this.getNextPlayableBall());else{var g=this.grid.getBalls();g.length>1?(this.sound.loss(),this.restartTimeout=setTimeout(function(){b.restart()},3e3)):(this.sound.victory(),this.restartTimeout=setTimeout(function(){b.restart(),b.nextLevel()},1e3))}}else this.shortcurmove=!1},Game.prototype.pressup=function(a){var a,b=this;if(a=this.shortcurmove?null:this.grid.moveTile(a.n,a.to_n))if(this.display.moveTile(a,this.shortcurmove),this.sound.move(),this.addPoints(),this.saveState(),this.getNextPlayableBall());else{var c=this.grid.getBalls();c.length>1?(this.sound.loss(),setTimeout(function(){b.restart()},3e3)):(this.sound.victory(),setTimeout(function(){b.restart(),b.nextLevel()},1e3))}},Game.prototype.getNextPlayableBall=function(){var a=this,b=this.grid.getBalls(),c=[],d=function(){var e=Math.floor(Math.random()*b.length);if(b[e]){var f=b[e],g=a.grid.movesArray(f.n);for(var h in g){var i=g[h];if(i){var j={from_n:f.n,dir:h,n:i};c.push(j)}}c.length>0||(b.splice(e,1),d())}};if(d(),c.length>0){var e=c[Math.floor(Math.random()*c.length)];return e}return!1},Game.prototype.autoPlayMatch=function(){{var a=this,b={},c=[],d=function(){var e=a.getNextPlayableBall();if(e){{a.grid.moveTile(e.from_n,e.n)}c.push({from_n:e.from_n,to_n:e.n}),d()}else{var f=a.grid.getBalls();f.length>1?b.win=!1:(b.win=!0,b.moves=c)}};d()}return b},Game.prototype.resolve=function(){var a=this,b=1e3,c=0,d={},e=function(){a.resetMatch();var f=a.autoPlayMatch();return c++,f&&f.win?(d.win=!0,d.moves=f.moves,d):c>=b?(d.win=!1,d):void e()},e=e();return d},Game.prototype.autoMove=function(a){var b=this,c=b.grid.moveTile(a.from_n,a.to_n);b.display.autoMoveTile(c)},Game.prototype.showMatch=function(){var a=this.resolve();if(a.win){var b=a.moves[0];this.autoMove(b)}},Game.prototype.draw_board=function(){this.sound.dispose()},Game.prototype.addPoints=function(){this.score--,this.displayPoints()},Game.prototype.displayPoints=function(){this.getNextPlayableBall()?this.display.setScore(this.score+" Movimientos Restantes"):this.score<=0?(this.display.displayText("Pegu-Fox!"),this.display.setScore("Tu Ganaste!")):(this.display.displayText("Damn!"),this.display.setScore("you left "+this.score+" pegs..."))},Game.prototype.displayLevelName=function(a){this.display.displayLevelName(a)},Game.prototype.readLevels=function(){var a;return $.ajax({url:"levels/levels.json",success:function(b){a=b},async:!1}),a},Game.prototype.resetMatch=function(){this.grid=new Grid(null,this.levels[this.levelID])},Game.prototype.render=function(){this.levelID=this.levelID<0?this.levels.length-1:this.levelID,this.levelID=this.levels[this.levelID]?this.levelID:0,this.level_name=this.levels[this.levelID].name,this.getGameStatus()&&this.storage.setLevelID(this.levelID);var a=this.storage.getLevel(this.levelID);this.level=a&&this.level_name!=a.name?null:a,this.grid=new Grid(this.level,this.levels[this.levelID]),this.display.render(this.grid,this.getGameStatus()),this.displayLevelName(this.level_name);var b=this.grid.getBalls().length-1;this.score=this.level?this.level.score:b,this.displayPoints()},Game.prototype.getGameStatus=function(){return this.storage.getGameStatus()},Game.prototype.setGameStatus=function(a){this.storage.setGameStatus(a)},Game.prototype.play=function(){this.setGameStatus(1),this.storage.getLevelID()!=this.levelID&&this.start()},Game.prototype.start=function(){var a=this;this.levelID=1==a.getGameStatus()?this.storage.getLevelID()||0:this.storage.getLevelID()||this.levels.length-1,this.render()},Game.prototype.restart=function(){this.restartTimeout&&clearTimeout(this.restartTimeout),this.storage.getCurrenLevel()&&(this.storage.clearCurrentLevel(),this.render())},Game.prototype.nextLevel=function(){this.saveState(),this.levelID++,this.render()},Game.prototype.previousLevel=function(){this.saveState(),this.levelID--,this.render()},Game.prototype.gotoLevel=function(a){this.saveState(),this.levelID=a,this.render()},Game.prototype.saveState=function(){this.grid&&this.storage.setLevel({grid:this.grid.serialize(),score:this.score,level:this.levelID,name:this.level_name})},Game.prototype.isopenSocial=function(){return this.social.isopen()},Game.prototype.openSocial=function(){this.social.addLayer()},Game.prototype.closeSocial=function(){this.social.destroyLayer()},jQuery(document).ready(function(a){var b=new Game;a(".play a").on("click",function(c){c.preventDefault(),a(".how_to_play").hide("200"),a("header").hide("500",function(){b.play()}),a(".game_asset").show("500")}),a("#infobtn").on("click",function(b){b.preventDefault(),a(".how_to_play").show("200"),a("header").show("500"),a(".game_asset").hide("500")}),a("#refresh").on("click",function(a){a.preventDefault(),b.restart()}),a("#next").on("click",function(a){a.preventDefault(),b.nextLevel()}),a("#previous").on("click",function(a){a.preventDefault(),b.previousLevel()}),a("#sharebtn").on("click",function(a){a.preventDefault(),b.isopenSocial()?b.closeSocial():b.openSocial()}),a(window).unload(function(){b.saveState()})});